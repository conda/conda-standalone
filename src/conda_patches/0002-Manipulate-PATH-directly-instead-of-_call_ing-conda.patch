From 39070423f8c5318bc6d8a7c69dec2423647331be Mon Sep 17 00:00:00 2001
From: Nehal J Wani <nehaljw.kkd1@gmail.com>
Date: Tue, 13 Aug 2019 07:46:10 -0400
Subject: [PATCH 2/4] Manipulate PATH directly instead of _call_ing conda.bat

---
 conda/utils.py | 24 +++++++++---------------
 1 file changed, 9 insertions(+), 15 deletions(-)

diff --git a/conda/utils.py b/conda/utils.py
index 8667a07aa..38648f99a 100644
--- a/conda/utils.py
+++ b/conda/utils.py
@@ -251,21 +251,15 @@ def wrap_subprocess_call(
             # fh.write("@FOR /F \"tokens=100\" %%F IN ('chcp') DO @SET CONDA_OLD_CHCP=%%F\n")
             # fh.write('@chcp 65001>NUL\n')
 
-            # We pursue activation inline here, which allows us to avoid
-            # spawning a `conda activate` process at wrapper runtime.
-            activator_cls = _build_activator_cls("cmd.exe.run")
-            activator_args = ["activate"]
-            if dev_mode:
-                activator_args.append("--dev")
-            activator_args.append(prefix)
-
-            activator = activator_cls(activator_args)
-            activator._parse_and_set_args()
-            activate_script = activator.activate()
-
-            for line in activate_script.splitlines():
-                fh.write(f"{silencer}{line}\n")
-
+            fh.write(
+                f'SET "PATH={prefix};'
+                f'{prefix}\\Library\\mingw-w64\\bin;'
+                f'{prefix}\\Library\\usr\\bin;'
+                f'{prefix}\\Library\\bin;'
+                f'{prefix}\\Scripts;'
+                f'{prefix}\\bin;'
+                '%PATH%"'
+            )
             fh.write(f"{silencer}IF %ERRORLEVEL% NEQ 0 EXIT /b %ERRORLEVEL%\n")
             if debug_wrapper_scripts:
                 fh.write("echo *** environment after *** 1>&2\n")
-- 
2.51.1.windows.1

